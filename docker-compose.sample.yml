version: '3'
services:
    importer-my:
        build:
            context: './crawler'
            dockerfile: './Dockerfile-importer'
        env_file:
            - envfile
        environment:
            IMPORT_FILE: '/var/lib/test-lists/lists/my.csv'
        volumes:
            - ./test-lists:/var/lib/test-lists
        restart: 'no'
    crawler-my:
        build:
            context: './crawler'
            dockerfile: './Dockerfile-crawler'
        env_file:
            - envfile
        environment:
            SLEEP_TIME: 1
            COUNTRY_CODE: 'MY'
        restart: 'always'

    patcher:
        build:
            context: './crawler'
            dockerfile: './Dockerfile-patcher'
        env_file:
            - envfile
        environment:
            IMPORT_FILE: '/var/lib/ooni-data/ooni-data.jsonl'
        volumes:
            - ./ooni-data:/var/lib/ooni-data
        restart: 'no'

    import-asn:
        build:
            context: './crawler'
            dockerfile: './Dockerfile-importer-asn'
        env_file:
            - envfile
        environment:
            IMPORT_FILE: '/var/lib/asn-list/GeoLite2-ASN-Blocks-IPv4.csv'
        volumes:
            - ./asn-list:/var/lib/asn-list
        restart: 'no'
